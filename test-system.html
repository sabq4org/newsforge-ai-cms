<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" />
    <title>Ø³Ø¨Ù‚ Ø§Ù„Ø°ÙƒÙŠØ© - Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù…</title>
    
    <!-- Load Google Fonts for Arabic -->
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'IBM Plex Sans Arabic', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: #f9fafb;
            direction: rtl;
            text-align: right;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .card {
            background: white;
            border-radius: 0.75rem;
            padding: 2rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }
        
        .btn {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            margin: 0.5rem;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            text-decoration: none;
            font-weight: 500;
            transition: background-color 0.2s ease;
        }
        
        .btn-primary {
            background: #2563eb;
            color: white;
        }
        
        .btn-primary:hover {
            background: #1d4ed8;
        }
        
        .btn-secondary {
            background: #f3f4f6;
            color: #374151;
            border: 1px solid #d1d5db;
        }
        
        .btn-secondary:hover {
            background: #e5e7eb;
        }
        
        .btn-danger {
            background: #dc2626;
            color: white;
        }
        
        .btn-danger:hover {
            background: #b91c1c;
        }
        
        .status-good {
            color: #059669;
            font-weight: 500;
        }
        
        .status-warning {
            color: #d97706;
            font-weight: 500;
        }
        
        .status-error {
            color: #dc2626;
            font-weight: 500;
        }
        
        h1 {
            color: #1f2937;
            margin-bottom: 1rem;
        }
        
        h2 {
            color: #374151;
            margin-bottom: 1rem;
        }
        
        .test-result {
            margin: 1rem 0;
            padding: 1rem;
            border-radius: 0.5rem;
            border: 1px solid #e5e7eb;
        }
        
        .test-success {
            background: #f0fdf4;
            border-color: #22c55e;
        }
        
        .test-warning {
            background: #fffbeb;
            border-color: #f59e0b;
        }
        
        .test-error {
            background: #fef2f2;
            border-color: #ef4444;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <h1>ğŸ§ª Ø³Ø¨Ù‚ Ø§Ù„Ø°ÙƒÙŠØ© - Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù…</h1>
            <p>Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© ØªØ³Ø§Ø¹Ø¯ ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø± ÙˆØªØ´Ø®ÙŠØµ Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ù‚Ø¨Ù„ ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ.</p>
        </div>

        <div class="card">
            <h2>ğŸ” ÙØ­Øµ Ø§Ù„Ù†Ø¸Ø§Ù…</h2>
            <div id="systemCheck">
                <p>Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø§Ù„Ù†Ø¸Ø§Ù…...</p>
            </div>
        </div>

        <div class="card">
            <h2>ğŸš€ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØªØ´ØºÙŠÙ„</h2>
            <p>Ø§Ø®ØªØ± ÙˆØ¶Ø¹ Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨:</p>
            
            <div>
                <a href="/" class="btn btn-primary">Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¹Ø§Ø¯ÙŠ</a>
                <a href="/?mode=safe-fallback" class="btn btn-secondary">Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¢Ù…Ù†</a>
                <a href="/?mode=full" class="btn btn-secondary">Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙƒØ§Ù…Ù„</a>
                <a href="/?mode=simple" class="btn btn-secondary">Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¨Ø³Ø·</a>
                <a href="/?emergency=true" class="btn btn-danger">ÙˆØ¶Ø¹ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦</a>
            </div>
        </div>

        <div class="card">
            <h2>ğŸ› ï¸ Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØµÙŠØ§Ù†Ø©</h2>
            <button onclick="clearStorage()" class="btn btn-secondary">Ù…Ø³Ø­ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ</button>
            <button onclick="resetApp()" class="btn btn-secondary">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</button>
            <button onclick="testFunctions()" class="btn btn-primary">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</button>
        </div>

        <div class="card">
            <h2>ğŸ“Š Ø³Ø¬Ù„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡</h2>
            <div id="errorLog">
                <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø®Ø·Ø§Ø¡ Ù…Ø³Ø¬Ù„Ø©.</p>
            </div>
        </div>
    </div>

    <script>
        // Error logging
        const errorLog = [];
        const originalConsoleError = console.error;
        console.error = function(...args) {
            errorLog.push({
                timestamp: new Date().toLocaleString('ar-SA'),
                message: args.join(' ')
            });
            updateErrorLog();
            originalConsoleError.apply(console, args);
        };

        // System check functions
        function checkBrowserSupport() {
            const checks = {
                'ES6 Support': () => {
                    try {
                        new Function('() => {}');
                        return true;
                    } catch {
                        return false;
                    }
                },
                'Local Storage': () => {
                    try {
                        localStorage.setItem('test', 'test');
                        localStorage.removeItem('test');
                        return true;
                    } catch {
                        return false;
                    }
                },
                'Fetch API': () => typeof fetch !== 'undefined',
                'Promise Support': () => typeof Promise !== 'undefined',
                'Array.forEach': () => typeof Array.prototype.forEach === 'function',
                'String.toLowerCase': () => typeof String.prototype.toLowerCase === 'function'
            };

            return checks;
        }

        function runSystemCheck() {
            const checks = checkBrowserSupport();
            const results = [];

            for (const [name, test] of Object.entries(checks)) {
                try {
                    const passed = test();
                    results.push({
                        name,
                        passed,
                        status: passed ? 'Ù†Ø¬Ø­' : 'ÙØ´Ù„',
                        className: passed ? 'test-success' : 'test-error'
                    });
                } catch (error) {
                    results.push({
                        name,
                        passed: false,
                        status: 'Ø®Ø·Ø£: ' + error.message,
                        className: 'test-error'
                    });
                }
            }

            const systemCheckDiv = document.getElementById('systemCheck');
            systemCheckDiv.innerHTML = results.map(result => 
                `<div class="test-result ${result.className}">
                    <strong>${result.name}:</strong> 
                    <span class="${result.passed ? 'status-good' : 'status-error'}">${result.status}</span>
                </div>`
            ).join('');
        }

        function testFunctions() {
            const tests = [
                {
                    name: 'Ø§Ø®ØªØ¨Ø§Ø± Array.forEach',
                    test: () => {
                        const arr = [1, 2, 3];
                        let sum = 0;
                        arr.forEach(n => sum += n);
                        return sum === 6;
                    }
                },
                {
                    name: 'Ø§Ø®ØªØ¨Ø§Ø± String.toLowerCase',
                    test: () => {
                        return 'HELLO'.toLowerCase() === 'hello';
                    }
                },
                {
                    name: 'Ø§Ø®ØªØ¨Ø§Ø± Date.toLocaleDateString',
                    test: () => {
                        const date = new Date();
                        return typeof date.toLocaleDateString() === 'string';
                    }
                },
                {
                    name: 'Ø§Ø®ØªØ¨Ø§Ø± JSON',
                    test: () => {
                        const obj = { test: 'value' };
                        return JSON.parse(JSON.stringify(obj)).test === 'value';
                    }
                }
            ];

            const results = tests.map(({ name, test }) => {
                try {
                    const passed = test();
                    return `<div class="test-result ${passed ? 'test-success' : 'test-error'}">
                        <strong>${name}:</strong> 
                        <span class="${passed ? 'status-good' : 'status-error'}">${passed ? 'Ù†Ø¬Ø­' : 'ÙØ´Ù„'}</span>
                    </div>`;
                } catch (error) {
                    return `<div class="test-result test-error">
                        <strong>${name}:</strong> 
                        <span class="status-error">Ø®Ø·Ø£: ${error.message}</span>
                    </div>`;
                }
            });

            const systemCheckDiv = document.getElementById('systemCheck');
            systemCheckDiv.innerHTML = '<h3>Ù†ØªØ§Ø¦Ø¬ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙˆØ¸Ø§Ø¦Ù:</h3>' + results.join('');
        }

        function clearStorage() {
            try {
                localStorage.clear();
                sessionStorage.clear();
                alert('ØªÙ… Ù…Ø³Ø­ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ Ø¨Ù†Ø¬Ø§Ø­');
            } catch (error) {
                alert('ÙØ´Ù„ ÙÙŠ Ù…Ø³Ø­ Ø§Ù„ØªØ®Ø²ÙŠÙ†: ' + error.message);
            }
        }

        function resetApp() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ØŸ Ø³ÙŠØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©.')) {
                clearStorage();
                window.location.href = '/';
            }
        }

        function updateErrorLog() {
            const errorLogDiv = document.getElementById('errorLog');
            if (errorLog.length === 0) {
                errorLogDiv.innerHTML = '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø®Ø·Ø§Ø¡ Ù…Ø³Ø¬Ù„Ø©.</p>';
            } else {
                errorLogDiv.innerHTML = errorLog.map(error => 
                    `<div class="test-result test-error">
                        <strong>${error.timestamp}:</strong> ${error.message}
                    </div>`
                ).join('');
            }
        }

        // Global error handler
        window.addEventListener('error', function(event) {
            console.error('JavaScript Error:', event.error);
        });

        window.addEventListener('unhandledrejection', function(event) {
            console.error('Unhandled Promise Rejection:', event.reason);
        });

        // Run system check on load
        runSystemCheck();
    </script>
</body>
</html>